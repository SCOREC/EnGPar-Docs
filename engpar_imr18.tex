%%%%%%%%%%%%%%%%%%%% author.tex %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% sample root file for your "contribution" to a contributed volume
%
% Use this file as a template for your own input.
%
%%%%%%%%%%%%%%%% Springer %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% RECOMMENDED %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[graybox]{svmult}

% choose options for [] as required from the list
% in the Reference Guide

\usepackage{mathptmx}       % selects Times Roman as basic font
\usepackage{helvet}         % selects Helvetica as sans-serif font
\usepackage{courier}        % selects Courier as typewriter font
\usepackage{type1cm}        % activate if the above 3 fonts are
                            % not available on your system
%
\usepackage{makeidx}         % allows index generation
\usepackage{url}             % links
\usepackage{graphicx}        % standard LaTeX graphics tool
                             % when including figure files
\usepackage{multicol}        % used for the two-column index
\usepackage[bottom]{footmisc}% places footnotes at page bottom

% see the list of further useful packages
% in the Reference Guide

\makeindex             % used for the subject index
                       % please use the style svind.ist with
                       % your makeindex program

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\title*{Accelerated Load Balancing of Unstructured Meshes}
% Use \titlerunning{Short Title} for an abbreviated version of
% your contribution title if the original one is too long
\author{
Gerrett Diamond,
Lucas Davis,
Cameron W. Smith,
and Mark S. Shephard
}
\institute{
  Gerrett Diamond \email{diamog@rpi.edu}
  \and Lucas Davis \email{davisl3@rpi.edu}
  \and Cameron W. Smith \email{smithc11@rpi.edu}
  \and Mark S. Shephard \email{shephard@rpi.edu}
  \at Rensselaer Polytechnic Institute, Troy, NY 
}
\authorrunning{G.Diamond et al.}

\maketitle

\abstract{
  gpus are in lots of big systems, we need to use them for load balancing
}

\section{Introduction} \label{sec:intro}

\begin{itemize}
  \item briefly motivate dynamic load balancing
  \item quantify how GPUs are providing the majority of computing performance (\# of systems with GPUs in top 10 systems of top500, graph500, HPCG)
  \item end with a sentence that says what engpar does (diffusion) and how we are
extending it to run on GPUs
\end{itemize}

\section{EnGPar Dynamic Load Balancing} \label{sec:engpar}

\begin{itemize}
  \item multi-graph, high-level diffusion algorithm (targeting, selection, migration)
  \item indicate that we will accelerate selection via BFS for distance computation and coloring for cavity selection
\end{itemize}

A cavity is formed by a hyperedge and the vertices pinned to it.

\section{Accelerating Distance Computation} \label{sec:dist}

provide results - serial vs kokkos w/cuda -
\url{https://bitbucket.org/c_smith/engpar_siampp18/src/master/}

\section{Accelerating Cavity Selection} \label{sec:select}

Accelerating the selection of cavities requires simulateously evaluating many
cavities simultaneously.
The current single threaded selection procedure evaluates cavities in order of
their descending distance from the topological center.
Since the ordered selection exposes no concurrency an alternative application of
the topological distance is needed.
One approach is to bin the cavities by distance.
For large parts, or parts with high surface area, this will expose a modest
amount of concurrency.
A second approach applies the topological distance sorting after a fully
parallel cavity evaluation has executed.
Given that this approach provides maximum concurrency during cavity evaluation,
and can use a data-parallel sorting operation, it is the prodcedure used in this
work.

Critical to concurrent cavity evaluation is avoiding race conditions when
writing and reading the integer associated with each graph vertex indicating
which process they will be migrated to.
Hyperedge coloring ensures that any two hyperedges that share a common vertex
will be assigned a different color.
Hyperedges with the same color can be evaluated concurrently without
race conditions.

{\color{red}A figure showing hyperedge cavity selection and conflicts would be
helpful}

Kokkos-kernels data-parallel graph coloring procedure REFERENCE is used to
color the hyperedges of the EnGPar hypergraph.
{\color{red}NOTE, we only really need to color the hyperedges on the part boundary,
but I doubt it is worth the work, or minor performance gain, to pass a reduced CSR.}
Transforming the hypergraph to the symmetric adjacency matrix required as input
to the coloring procedure requires creating the dual of the hypergraph.
The dual graph represents the second adjacencies of
hyperedge-to-vertex-to-hyperedge by creating one vertex for each hyperedge, and
an edge between two hyperedges if they share at least one common vertex.
Kokkos-kernel's graph coloring algorithm is then called to color this dual graph
which returns a coloring of the original graph's hyperedges.

\begin{itemize}
  \item do we need to provide coloring-only timings here or will that all go in
    the results section?
\end{itemize}

\section{Application Results} \label{sec:results}

\begin{itemize}
  \item Figure out a better title for this section
  \item flow control strong scaling case with 1.3B tets: \\
64Ki \url{https://zenodo.org/record/833519#.WztuxXWYV1M} \\
128Ki \url{https://zenodo.org/record/834946#.Wztu-HWYV1M} \\
256Ki \url{https://zenodo.org/record/835483#.WztvCXWYV1M} \\
512Ki \url{https://zenodo.org/record/835742#.WztvG3WYV1M}
  \item the number of elements per-process may be too small for nodes with large GPUs to run efficiently (data transfer may become more costly than running the selection on the CPU!) - especially as we approach 512Ki parts
  \item we will have to run the condense tool to create an 2Ki (640k elms/part),
    4Ki (320k), 8Ki (160k), 16Ki (80k), and 32Ki (40k) meshes -
    fun3d uses between 75M and 2.3M elements per GPU on summitdev (from siampp18
    presentation)
  \item run on ORNL titan or summit (if accessible)
  \item compare runtimes versus results from SC17 paper~\cite{engparSC17}
  \item use mesh vertex = graph vertex and mesh edge = graph edge for tests -
    will need to run MPI only engpar to establish the baseline performance
  \item plot the time spent in MPI only selection vs kokkos coloring selection
    vs part size - the comparison must start and end at equivalent points in the
    code - start before selection and end just before migration (or whatever the
    next stage) begins
  \item plot the breakdown of time spent in coloring selection vs part size -
    data transfer, color computation, selection (possibly broken into cavity
    selection and filtering for distance), tranferring the selection list
    back to the host
  \item I expect there will be some reduction in partition quality using the
    coloring based selection since we won't have as fine-grained control over
    the process as the MPI only procedure.  As long as the quality reduction is
    controlled and performance is better we should be OK.
\end{itemize}

\section{Closing Remarks} \label{sec:closing}
\begin{itemize}
  \item summarize results
  \item discuss hypergraph coloring and relation to distance-2 coloring for non-simplices (quads, hexs, prisms, pyramids, etc.)
\end{itemize}

\begin{acknowledgement}
This research was supported by the U.S. Department of Energy, Office of Science,
Office of Advanced Scientific Computing Research, under award DE-SC00066117
(FASTMath SciDAC Institute) and by the National Science Foundation under Grant
No. ACI 1533581, (SI2-SSE: Fast Dynamic Load Balancing Tools for Extreme Scale
Systems).

We gratefully acknowledge the use of the resources of the ABC and the XYZ.

Any opinions, findings, and conclusions or recommendations expressed in this
material are those of the author(s) and do not necessarily reflect the views
of the National Science Foundation.
\end{acknowledgement}

\bibliographystyle{acm}
\bibliography{scorec-refs/scorec-refs}
\end{document}
